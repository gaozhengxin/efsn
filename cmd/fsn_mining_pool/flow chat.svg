<svg id="SvgjsSvg1006" width="1092" height="655" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs"><defs id="SvgjsDefs1007"></defs><g id="SvgjsG1008" transform="translate(25,25)"><path id="SvgjsPath1009" d="M 0 0L 288 0L 288 605L 0 605Z" stroke="#323232" stroke-width="2" fill="none"></path><path id="SvgjsPath1010" d="M 0 0L 288 0L 288 40L 0 40Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1011"><foreignObject id="SvgjsForeignObject1012" width="268" height="20" x="10" style="overflow:visible;" y="10"><div style="font-family: 微软雅黑; text-align: center; font-size: 16px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 20px; width: 268px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">每分钟跟踪mongo数据库变化<div></div></div></foreignObject></g></g><g id="SvgjsG1013" transform="translate(313,25)"><path id="SvgjsPath1014" d="M 0 0L 288 0L 288 605L 0 605Z" stroke="#323232" stroke-width="2" fill="none"></path><path id="SvgjsPath1015" d="M 0 0L 288 0L 288 40L 0 40Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1016"><foreignObject id="SvgjsForeignObject1017" width="268" height="20" x="10" style="overflow:visible;" y="10"><div style="font-family: 微软雅黑; text-align: center; font-size: 16px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 20px; width: 268px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">Withdraw channel收到提币消息<div></div></div></foreignObject></g></g><g id="SvgjsG1018" transform="translate(601,25)"><path id="SvgjsPath1019" d="M 0 0L 466 0L 466 605L 0 605Z" stroke="#323232" stroke-width="2" fill="none"></path><path id="SvgjsPath1020" d="M 0 0L 466 0L 466 40L 0 40Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1021"><foreignObject id="SvgjsForeignObject1022" width="446" height="20" x="10" style="overflow:visible;" y="10"><div style="font-family: 微软雅黑; text-align: center; font-size: 16px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 20px; width: 446px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">每天0点结算</div></foreignObject></g></g><g id="SvgjsG1023" transform="translate(69.375,84)"><path id="SvgjsPath1024" d="M 0 0L 199.25 0L 199.25 43L 0 43Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1025"><foreignObject id="SvgjsForeignObject1026" width="179.25" height="32" x="10" style="overflow:visible;" y="5.5"><div style="font-family: 微软雅黑; text-align: center; font-size: 13px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 16px; width: 179.25px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">查询mongodb中最新的block number<div></div></div></foreignObject></g></g><g id="SvgjsG1027" transform="translate(69.375,142)"><path id="SvgjsPath1028" d="M 0 0L 199.25 0L 199.25 52L 0 52Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1029"><foreignObject id="SvgjsForeignObject1030" width="179.25" height="32" x="10" style="overflow:visible;" y="10"><div style="font-family: 微软雅黑; text-align: center; font-size: 13px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 16px; width: 179.25px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">查找前一次结束位置到最新block number - 10之间的交易<div></div></div></foreignObject></g></g><g id="SvgjsG1031" transform="translate(69.375,208)"><path id="SvgjsPath1032" d="M 0 0L 199.25 0L 199.25 43L 0 43Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1033"><foreignObject id="SvgjsForeignObject1034" width="179.25" height="16" x="10" style="overflow:visible;" y="13.5"><div style="font-family: 微软雅黑; text-align: center; font-size: 13px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 16px; width: 179.25px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">找出存入矿池地址的交易<div></div></div></foreignObject></g></g><g id="SvgjsG1035" transform="translate(697.375,207.25)"><path id="SvgjsPath1036" d="M 0 0L 273.25 0L 273.25 44.5L 0 44.5Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1037"><foreignObject id="SvgjsForeignObject1038" width="253.25" height="16" x="10" style="overflow:visible;" y="14.25"><div style="font-family: 微软雅黑; text-align: center; font-size: 13px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 16px; width: 253.25px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">计算资金池一共打出多少资金</div></foreignObject></g></g><g id="SvgjsG1039" transform="translate(348.375,83)"><path id="SvgjsPath1040" d="M 0 0L 217.25 0L 217.25 45L 0 45Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1041"><foreignObject id="SvgjsForeignObject1042" width="197.25" height="16" x="10" style="overflow:visible;" y="14.5"><div style="font-family: 微软雅黑; text-align: center; font-size: 13px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 16px; width: 197.25px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">更新mongodb的Assets表<div></div></div></foreignObject></g></g><g id="SvgjsG1043" transform="translate(697.375,85)"><path id="SvgjsPath1044" d="M 0 0L 273.25 0L 273.25 43L 0 43Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1045"><foreignObject id="SvgjsForeignObject1046" width="253.25" height="16" x="10" style="overflow:visible;" y="13.5"><div style="font-family: 微软雅黑; text-align: center; font-size: 13px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 16px; width: 253.25px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">获取上一次结算时处理到的位置<div></div></div></foreignObject></g></g><g id="SvgjsG1047" transform="translate(697.375,142)"><path id="SvgjsPath1048" d="M 0 0L 273.25 0L 273.25 52L 0 52Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1049"><foreignObject id="SvgjsForeignObject1050" width="253.25" height="32" x="10" style="overflow:visible;" y="10"><div style="font-family: 微软雅黑; text-align: center; font-size: 13px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 16px; width: 253.25px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">查找上一次结算位置之后所有从资金池打出的转账交易</div></foreignObject></g></g><g id="SvgjsG1051" transform="translate(348.375,142)"><path id="SvgjsPath1052" d="M 0 0L 217.25 0L 217.25 52L 0 52Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1053"><foreignObject id="SvgjsForeignObject1054" width="197.25" height="16" x="10" style="overflow:visible;" y="18"><div style="font-family: 微软雅黑; text-align: center; font-size: 13px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 16px; width: 197.25px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">从资金池向提币用户发交易</div></foreignObject></g></g><g id="SvgjsG1055" transform="translate(697.375,266)"><path id="SvgjsPath1056" d="M 0 0L 273.25 0L 273.25 41L 0 41Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1057"><foreignObject id="SvgjsForeignObject1058" width="253.25" height="16" x="10" style="overflow:visible;" y="12.5"><div style="font-family: 微软雅黑; text-align: center; font-size: 13px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 16px; width: 253.25px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">从矿池向资金池打币<div></div></div></foreignObject></g></g><g id="SvgjsG1059" transform="translate(624.5,390)"><path id="SvgjsPath1060" d="M 0 0L 419 0L 419 79L 0 79Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1061"><foreignObject id="SvgjsForeignObject1062" width="399" height="32" x="10" style="overflow:visible;" y="23.5"><div style="font-family: 微软雅黑; text-align: center; font-size: 13px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 16px; width: 399px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml"><div>计算每个用户的收益:</div><div>用户收益 = 总收益 * (用户当天资金/全部用户当天资金) * (1 - 手续费)<div></div></div></div></foreignObject></g></g><g id="SvgjsG1063" transform="translate(697.375,322)"><path id="SvgjsPath1064" d="M 0 0L 273.25 0L 273.25 52L 0 52Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1065"><foreignObject id="SvgjsForeignObject1066" width="253.25" height="32" x="10" style="overflow:visible;" y="10"><div style="font-family: 微软雅黑; text-align: center; font-size: 13px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 16px; width: 253.25px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml"><div>矿池计算上一次结算到当前全部的收益:</div><div>当前余额 - 上一次结算后的余额<div></div></div></div></foreignObject></g></g><g id="SvgjsG1067" transform="translate(678.84375,483)"><path id="SvgjsPath1068" d="M 0 0L 310.3125 0L 310.3125 55L 0 55Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1069"><foreignObject id="SvgjsForeignObject1070" width="290.3125" height="16" x="10" style="overflow:visible;" y="19.5"><div style="font-family: 微软雅黑; text-align: center; font-size: 13px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 16px; width: 290.313px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">资金池向用户发送收益, 如果发送失败保存记录<div></div></div></foreignObject></g></g><g id="SvgjsG1071" transform="translate(69.375,331)"><path id="SvgjsPath1072" d="M 0 0L 199.25 0L 199.25 43L 0 43Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1073"><foreignObject id="SvgjsForeignObject1074" width="179.25" height="32" x="10" style="overflow:visible;" y="5.5"><div style="font-family: 微软雅黑; text-align: center; font-size: 13px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 16px; width: 179.25px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">记录这个循环的结束时处理到的区块位置</div></foreignObject></g></g><g id="SvgjsG1075" transform="translate(69.375,270)"><path id="SvgjsPath1076" d="M 0 0L 199.25 0L 199.25 43L 0 43Z" stroke="#323232" stroke-width="2" fill-opacity="1" fill="#ffffff"></path><g id="SvgjsG1077"><foreignObject id="SvgjsForeignObject1078" width="179.25" height="16" x="10" style="overflow:visible;" y="13.5"><div style="font-family: 微软雅黑; text-align: center; font-size: 13px; vertical-align: middle; color: rgb(50, 50, 50); font-weight: 400; line-height: 16px; width: 179.25px; word-break: break-word; border: 0px none;" xmlns="http://www.w3.org/1999/xhtml">更新mongodb的Assets表</div></foreignObject></g></g></svg>